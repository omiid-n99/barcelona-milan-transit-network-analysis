\documentclass{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{float}
\usepackage{subcaption}
\usepackage{amsmath}
\usepackage{url}


\title{Understanding Urban Transit Through Network Science: An Analysis of Milan and Barcelona}

\author {Amir Masoud Aghaei, Artificial Intelligence,\\Gita Javadi, Artificial Intelligence, 0001158007\\
Omid Nejati, Artificial Intelligence, 0001154905\\ Alireza Shahidiani, Artificial Intelligence, 0001154402 }

\date{November 2025}

\begin{document}

\maketitle

\section{Introduction}

Public transportation systems play a central role in the functioning of modern cities, shaping daily mobility, regional accessibility, and long-term urban development. As urban areas continue to expand and population densities increase, the efficiency and resilience of public transport networks have become critical concerns for planners, policymakers, and researchers. The analytical study of these systems has increasingly relied on Social Network Analysis (SNA), a methodological framework capable of capturing the structural properties, connectivity, and navigational efficiency of complex transport infrastructures. By modelling transit stops as nodes and connections as edges, network analysis provides an effective way to uncover patterns that are often difficult to detect using traditional transport engineering approaches.

This project examines and compares the public transportation networks of Milan and Barcelona, two major European cities with extensive, multimodal transit systems. Both cities feature dense urban fabrics, strong commuter flows, and well-integrated bus, tram, and metro services. Their reliance on public transport as a central mobility pillar, together with their availability of standardized GTFS datasets, makes them ideal case studies for evaluating how network topology influences accessibility, resilience, and overall system performance.

Recent research highlights the effectiveness of complex network analysis in identifying structural weaknesses, critical nodes, and opportunities for optimization in public transport networks~\cite{a}. Lin et al.\ (2021) demonstrate that network-theoretic measures such as global efficiency, clustering, and centrality can meaningfully guide improvements in urban mobility planning, helping cities achieve more balanced and sustainable transport systems~\cite{a}. Building on these insights, the present study applies established SNA techniques to evaluate the structural properties of Milan and Barcelona’s transit systems and uncover patterns that may inform future transportation strategies.


\section{Problem and Motivation}

European cities face persistent challenges related to congestion, air pollution, unequal accessibility, and rising mobility demands. Although both Milan and Barcelona have developed extensive public transport infrastructures, it remains difficult to assess how effectively these networks distribute connectivity, maintain resilience under disruptions, and support equitable travel across different urban zones. Traditional performance metrics—such as vehicle frequency or ridership statistics—provide valuable operational information, but they often fail to capture the deeper structural characteristics that influence navigability and long-term system robustness.

This project aims to address this gap by conducting a structural analysis of the public transportation networks of Milan and Barcelona through the lens of Social Network Analysis. Understanding how these networks are organized—where central hubs arise, how communities form, and how efficiently passengers can traverse the system—is essential for identifying vulnerabilities and suggesting improvements. Prior studies, including the work of Lin et al.\ (2021), demonstrate that complex network theory can reveal hidden inefficiencies and structural imbalances in transit systems, offering a powerful framework for optimization and planning~\cite{a}.

To investigate these aspects in a systematic way, the project employs a comprehensive set of network-theoretic measures capable of capturing both local and global properties of the systems. Classical centrality indicators—degree, betweenness, closeness, and eigenvector centrality—are used to identify influential stops, critical transfer points, and the nodes that most strongly shape passenger flows. Structural cohesion and hierarchical organisation are examined through k-core decomposition and modularity-based community detection, which reveal the presence of strong cores, peripheral regions, and coherent subnetworks within each city.

Beyond local structure, the study incorporates global measures to evaluate navigability, efficiency, and resilience. These include global efficiency and average path length, which quantify how easily passengers can move across the entire network; assortativity, which describes whether highly connected stops tend to link to other hubs or peripheral nodes; edge betweenness centrality, which highlights critical routes rather than individual stops; and targeted robustness simulations, which assess how the network behaves under node or edge failures. Together, this set of measures provides a multidimensional analytical framework for comparing the two systems and for uncovering the organisational principles that support—or hinder—urban mobility in Milan and Barcelona.

The main contribution of this study is to provide a quantitative, topology-based comparison of two major European transit networks using publicly available GTFS data and a consistent methodological approach. By examining centrality, community structure, global efficiency, and robustness, the project seeks to identify meaningful similarities and differences in the systems’ structural patterns. Ultimately, this analysis contributes to the broader discussion on data-driven, evidence-based approaches to improving urban mobility and long-term transport sustainability.


\section{Datasets}

This project relies on General Transit Feed Specification (GTFS) datasets describing the public transportation systems of Milan and Barcelona. GTFS is an open, standardized data format that provides detailed information on transit stops, routes, trips, schedules, and service calendars, making it especially suitable for systematic and reproducible transport network analysis.~\cite{c}

The datasets used in this study were obtained from the Transitland platform, a global aggregator of GTFS feeds that provides unified access to data published by transit agencies worldwide~\cite{d}. For Barcelona, we used the official GTFS feed published by Transports Metropolitans de Barcelona (TMB), while for Milan we used the feed provided by Azienda Trasporti Milanesi (ATM). The datasets were downloaded in their original format, requiring no digitization, and ensuring fidelity to the official transit systems.

All GTFS files (such as \texttt{stops.txt}, \texttt{routes.txt}, and \texttt{trips.txt} ) were processed using Python. Data handling and preprocessing were performed with \texttt{pandas} DataFrames~\cite{e}, which provided a flexible framework for merging, filtering, and manipulating the interconnected GTFS tables. To construct the network representations, we modeled stops as nodes and scheduled trips as edges. When multiple trips connected the same pair of stops, the number of weekly services was aggregated and used as an edge weight to approximate service frequency.

Network computations—such as centrality metrics, efficiency measures, and community detection—were performed using the \texttt{NetworkX} library. This enabled the construction of weighted, undirected graphs for each city and ensured a consistent methodology for comparing network structures. Spatial visualizations were created using \texttt{geopandas}, \texttt{folium}, and \texttt{matplotlib}, allowing accurate mapping of transit stops and connections in their real geographic context.

The datasets sourced from Transitland are openly available and do not require any special permissions. Their standardized format, combined with well-established Python tools, ensures a fully reproducible workflow, allowing other researchers to replicate or extend this study without ambiguity.



\section{Advanced Topological Metrics}

In this study, the analysis framework is organized into four distinct groups of 
network measures, each capturing a different structural or functional 
characteristic of the transport system:

\begin{enumerate}
    \item \textbf{Centrality Measures (4 metrics):}  
    These quantify the importance and influence of nodes within the network,  
    including Degree Centrality, Betweenness Centrality, Closeness Centrality,  
    and Eigenvector Centrality. Together, they describe how a station 
    contributes to flow, accessibility, and global influence.

    \item \textbf{Structural Measures (3 metrics):}  
    These capture the deeper architectural properties of the network:  
    Edge Betweenness Centrality identifies bottleneck edges,  
    K-core Decomposition reveals hierarchical layers of connectivity,  
    and Modularity (Community Detection) uncovers the natural substructures 
    of the network.

    \item \textbf{Efficiency Measures (3 metrics):}  
    Average Path Length and Global Efficiency characterize the speed and 
    optimality of travel within the network, while Assortativity measures 
    degree–degree correlations that indicate whether hubs tend to connect 
    to other hubs.

    \item \textbf{Robustness Measures (2 metrics):}  
    These assess resilience under failures or attacks, including robustness 
    under random node removal and under targeted (degree-based) node removal.  
\end{enumerate}




\section{Results and Discussion}

\subsection{Centrality Measures}

\subsubsection{Degree Centrality}

Degree centrality measures how many direct connections each stop has in the network.
In public transportation systems, stops with high degree centrality act as important
hubs where multiple routes intersect, while low-degree stops are usually peripheral
and less integrated into the system.

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{deg_bcn_map.png}
        \caption{Barcelona}
        \label{fig:deg-bcn-map}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{deg_mil_map.png}
        \caption{Milan}
        \label{fig:deg-mil-map}
    \end{subfigure}
    \caption{Degree centrality map of the two cities.}
    \label{fig:deg-map}
\end{figure}

Figure~\ref{fig:deg-map} shows the spatial distribution of degree centrality for
Barcelona and Milan. In Barcelona, the highest degree values are concentrated in
the central and southern parts of the city, with prominent hubs such as
\textit{Paral·lel -- Pl Espanya}, \textit{Pl Espanya -- FGC} and
\textit{Av dels Quinze -- Serrano}. These stops reach total degrees between 8
and 12 and correspond to major bus--metro interchanges and dense crossing points
of the urban road network. Peripheral and coastal areas, by contrast, exhibit
much lower degree values and a sparser stop configuration.

Milan exhibits a more radial structure. The most connected stops cluster around
the inner transport ring and key interchange stations, including
\textit{Comasina M3}, \textit{Diaz}, \textit{Stazione Lambrate M2} and
\textit{Stazione Centrale}. The stop \textit{Comasina M3} attains the highest
degree in the dataset (total degree $=16$), highlighting its role as a major
transfer hub at the terminus of a metro line. Outside this inner belt, the
network extends into long branches of low-degree stops, consistent with a
hub-and-spoke layout typical of metropolitan bus systems.

The summary statistics of the directed degrees confirm that the average degree is similar in both networks, but Barcelona distributes connectivity more evenly across its central corridor, while Milan concentrates it into a smaller number of major interchange nodes.
 Barcelona has an average total
degree of $2.59$ (maximum $12$) over $2771$ stops, while Milan has an average of
$2.49$ (maximum $16$) over $4913$ stops. In both cities the interquartile range
for total degree lies between 2 and 3, meaning that most stops connect to only a
small number of neighbours and that high-degree hubs are relatively rare.

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{deg_bcn_dist.png}
        \caption{Barcelona}
        \label{fig:deg-bcn-dist}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{deg_mil_dist.png}
        \caption{Milan}
        \label{fig:deg-mil-dist}
    \end{subfigure}
    \caption{Degree centrality distribution of the two cities.}
    \label{fig:deg-dist}
\end{figure}

The degree centrality distributions in Figure~\ref{fig:deg-dist} show a strong
peak at low values and a long right tail for both cities. This indicates that the
networks are composed of many lightly connected stops together with a small set
of highly connected hubs. Barcelona’s distribution reaches slightly higher
centrality values, reflecting several medium-size hubs spread across the central
corridor. Milan’s distribution is more concentrated, with a few very dominant
stops such as \textit{Comasina M3} and \textit{Stazione Centrale}.

% -------------------------------------------------------
% INSERTED ACADEMIC CONTEXT PARAGRAPH (FROM ARTICLE)
% -------------------------------------------------------
These patterns are consistent with empirical findings reported in studies of large
public transport networks. Von Ferber et al.\ \cite{vonferber} show that PTNs typically exhibit
heterogeneous degree distributions characterised by many low-degree nodes and a
small number of highly connected hubs. Depending on the network representation,
these distributions often follow exponential or power-law decay, reflecting the
structural contrast between dense urban cores and sparsely connected peripheral
areas. The behaviour observed in Barcelona and Milan aligns closely with these
general characteristics.

% -------------------------------------------------------

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{deg_bcn_top5.png}
        \caption{Barcelona}
        \label{fig:deg-bcn-top5}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{deg_mil_top5.png}
        \caption{Milan}
        \label{fig:deg-mil-top5}
    \end{subfigure}
    \caption{Top five stops by degree centrality in each city.}
    \label{fig:deg-top5}
\end{figure}

Figure~\ref{fig:deg-top5} highlights the five most connected stops in each city
and summarises these patterns. Barcelona’s hubs are distributed along the main
east--west corridor and around major squares, indicating several alternative
points of access to the network. Milan’s top-degree stops are more tightly
aligned with metro interchanges on the inner ring, suggesting a stronger
dependence on a small set of central transfer stations.

Overall, both cities display skewed degree distributions typical of real-world
transport networks, with many peripheral stops supported by a few hubs. Barcelona
shows a more distributed connectivity structure, whereas Milan relies more heavily
on a limited number of highly connected central nodes.

\subsubsection{Betweenness Centrality}

Betweenness centrality measures how often a stop lies on the shortest paths between
other stops in the network. In public transportation systems, stops with high
betweenness serve as critical transfer points that facilitate efficient movement 
across the network. Such stops typically handle a disproportionate amount of 
passenger flow, making them essential for connectivity but also potential points 
of vulnerability.

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{betweenness_bcn_map.png}
        \caption{Barcelona}
        \label{fig:btw-bcn-map}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{betweenness_mil_map.png}
        \caption{Milan}
        \label{fig:btw-mil-map}
    \end{subfigure}
    \caption{Betweenness centrality map of the two cities.}
    \label{fig:btw-map}
\end{figure}

Figure~\ref{fig:btw-map} shows that the highest betweenness values in Barcelona 
are concentrated along the major east--west corridors, particularly around 
\textit{Badajoz -- Diagonal}, \textit{Pl Universitat}, and \textit{Diagonal -- 
Ciutat de Granada}. These stops form part of a continuous structural spine running 
through the Eixample district, indicating that many shortest paths rely on this 
central axis. Milan displays an even more pronounced centralization pattern: the 
largest betweenness values appear around \textit{Cadorna M1/M2}, 
\textit{Stazione Centrale}, and \textit{Diaz}, forming a dense core of major 
transfer hubs within the inner transport ring.

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{betweenness_bcn_dist.png}
        \caption{Barcelona}
        \label{fig:btw-bcn-dist}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{betweenness_mil_dist.png}
        \caption{Milan}
        \label{fig:btw-mil-dist}
    \end{subfigure}
    \caption{Betweenness centrality distribution of the two cities.}
    \label{fig:btw-dist}
\end{figure}

The distributions in Figure~\ref{fig:btw-dist} show a characteristic long-tailed
shape in both cities: the vast majority of stops have very low betweenness, while 
a small subset exhibits substantially higher values. Barcelona’s maximum 
betweenness is $0.1987$, whereas Milan reaches $0.2716$, suggesting that Milan’s 
network is more centralized and relies more heavily on a few major transfer hubs.
Barcelona has a slightly higher median ($0.0061$ vs.\ $0.0033$), indicating a more 
even spread of intermediate transfer roles across multiple stops.

These patterns align with established findings in public transport network research.
Von Ferber et al.\ \cite{vonferber} show that betweenness distributions in large PTNs typically 
display strong heterogeneity, with a few highly central nodes forming the backbone 
for most passenger flows. This behaviour is linked to the presence of dense urban 
cores and sparser peripheral areas, and reflects a fundamental organizational 
principle observed across many transit systems. The results for Barcelona and Milan 
follow this general structure, with Milan showing a more sharply centralized core.

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{betweenness_bcn_top5.png}
        \caption{Barcelona}
        \label{fig:btw-bcn-top5}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{betweenness_mil_top5.png}
        \caption{Milan}
        \label{fig:btw-mil-top5}
    \end{subfigure}
    \caption{Top five stops by betweenness centrality in each city.}
    \label{fig:btw-top5}
\end{figure}

Figure~\ref{fig:btw-top5} highlights the top five transfer nodes in each network.
Barcelona’s most central stops are distributed along the main Diagonal–Gran Via
corridor, reflecting a multi-hub backbone with several parallel routes supporting 
network flow. Milan’s top-five stops, by contrast, are tightly concentrated around 
major metro interchanges such as \textit{Cadorna M1/M2} and \textit{Stazione 
Centrale}, demonstrating a more hierarchical structure.

Overall, Barcelona exhibits a more distributed pattern of betweenness, while Milan
relies heavily on a small number of highly central hubs. This makes Milan efficient
for rapid transfers through its core but potentially more vulnerable to disruptions 
at its key interchange stations. Barcelona’s broader distribution enhances resilience 
but may diffuse passenger flows across multiple corridors.

\subsubsection{Closeness Centrality}

Closeness centrality quantifies how efficiently a stop can reach all other stops 
in the network and therefore reflects its overall accessibility. Stops with high 
closeness centrality tend to be located in areas with dense, well-connected 
transport infrastructure, whereas peripheral or isolated stops typically exhibit 
much lower values.

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{closeness_bcn_map.png}
        \caption{Barcelona}
        \label{fig:close-bcn-map}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{closeness_mil_map.png}
        \caption{Milan}
        \label{fig:close-mil-map}
    \end{subfigure}
    \caption{Closeness centrality map of the two cities.}
    \label{fig:close-map}
\end{figure}

Figure~\ref{fig:close-map} shows that closeness centrality in Barcelona is highest 
along the central grid of the Eixample and Sant Mart\'i districts. The most 
accessible stops---such as \textit{Val\`encia -- Pg Sant Joan}, \textit{Josep 
Tarradellas -- Viladomat}, and \textit{Pg de Sant Joan -- Pl Moss\`en Jacint 
Verdaguer}---form a continuous high-accessibility corridor through the city. 
Barcelona displays a broad range of closeness values (mean $5.02$, median $5.70$), 
with steep declines toward sparsely served or topographically constrained 
neighbourhoods, such as Vallvidrera and Tibidabo.

Milan exhibits a more centralized pattern. The highest closeness values (mean 
$7.01$, median $7.62$) cluster tightly around the inner metropolitan ring. Stops 
such as \textit{Via Bernina}, \textit{Viale Jenner}, \textit{Loreto M1/M2}, and 
\textit{Lancetti} dominate the ranking, reflecting the city’s radial--concentric 
transport design. Accessibility decreases sharply toward outer municipalities 
including Bareggio, Cornaredo, and Cormano, whose stops show very low closeness 
values due to long distances and fewer direct routes to the urban core.

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{closeness_bcn_dist.png}
        \caption{Barcelona}
        \label{fig:close-bcn-dist}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{closeness_mil_dist.png}
        \caption{Milan}
        \label{fig:close-mil-dist}
    \end{subfigure}
    \caption{Closeness centrality distribution of the two cities.}
    \label{fig:close-dist}
\end{figure}

The distributions shown in Figure~\ref{fig:close-dist} reveal these structural 
differences more clearly. Barcelona’s distribution is broad, with many stops 
occupying intermediate levels of accessibility, consistent with the city’s 
multi-corridor grid layout. Milan’s distribution, by contrast, features a stronger 
concentration of high values, indicating a more hierarchical design where central 
interchanges offer significantly shorter path lengths to the rest of the network.

These findings are consistent with empirical studies of large public transport 
networks. Von Ferber et al.\ \cite{vonferber} highlight that closeness centrality in PTNs 
typically reflects the contrast between dense, highly accessible city cores and 
sparsely connected peripheral regions, often producing wide yet structured 
distributions of accessibility. The patterns observed in Barcelona and Milan align 
with this behaviour, with Milan exhibiting stronger centralization and Barcelona a 
more distributed accessibility structure.

Overall, Milan’s network provides very efficient access to its central areas but 
relies more heavily on a compact set of core stops, which may increase sensitivity 
to disruptions. Barcelona offers a more evenly distributed accessibility pattern 
within its central grid but experiences more pronounced declines toward its 
geographically constrained outskirts.



\subsubsection{Eigenvector Centrality: Core vs. Corridor Influence}
The Eigenvector Centrality analysis revealed a fundamental difference in how influence is distributed across the two cities:

\begin{itemize}
    \item \textbf{Milan (Centralized Power):} The most influential nodes were identified as \textit{Centrale FS}, \textit{Garibaldi FS}, and \textit{Zara}. This confirms that Milan’s network relies heavily on its central railway and metro interchanges. The influence is concentrated in the geographic center and diminishes rapidly towards the periphery.
    \item \textbf{Barcelona (Strategic Corridors):} Surprisingly, the highest Eigenvector scores were not found in the city center, but along the \textbf{L9 Sud corridor} (Nodes: \textit{Parc Nou, Aeroport T2, Fira}). This indicates that Barcelona’s topology prioritizes high-speed connectors that link strategic economic zones (Airport, Trade Fair) to the rest of the grid, rather than funneling all influence through a single downtown hub.
\end{itemize}


\begin{figure}[H]
    \centering
   
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\linewidth]{eigen1.png} 
        \caption{Barcelona}
    \end{subfigure}
    \hfill 
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\linewidth]{eigen2.png}
        \caption{Milan}
    \end{subfigure}
    
    \caption{Comparison of Eigenvector Centrality in Barcelona and Milan.}
    \label{fig:comparison_map}
\end{figure}


\subsection{Structural Measures}

\subsubsection{Critical Infrastructure (Edge Betweenness)}
The Edge Betweenness analysis highlighted the physical vulnerabilities of the networks:

\begin{itemize}
    \item \textbf{Critical Bridges:} In both cities, the algorithm identified specific ``arteries'' (visualized in red/yellow in Figure \ref{fig:betweenness}) that carry a disproportionate amount of passenger flow. These edges represent the unique shortest paths for substantial portions of the population.
    \item \textbf{Redundancy:} Barcelona’s grid-like mesh resulted in a more distributed set of critical edges. In contrast, Milan showed higher pressure on the radial lines entering the city center, suggesting that a failure in one of Milan's central ``spokes'' would have a more catastrophic impact on global efficiency than a similar failure in Barcelona's mesh.
\end{itemize}

\begin{figure}[H]
    \centering
    
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\linewidth]{betweeness1.png} 
        \caption{Barcelona}
    \end{subfigure}
    \hfill 
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\linewidth]{betweeness2.png} 
        \caption{Milan}
    \end{subfigure}
    
    \caption{Edge Betweenness Centrality illustrating critical transport bottle-necks.}
    \label{fig:comparison_map}
\end{figure}


\subsubsection{K-Core Decomposition}

To understand the hierarchical layers of the network, we utilized \textbf{K-core Decomposition}. This method recursively removes nodes with a degree less than $k$ until only nodes with degree $\geq k$ remain. The result effectively "peels" the network like an onion to reveal its most densely connected internal structure (the core) versus its outer layers (the periphery).

We first analyzed the statistical distribution of core numbers ($k$) across all stations (Figure \ref{fig:coreness_dist}).

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{bar_coreness.png}
        \caption{Barcelona Coreness Distribution}
        \label{fig:bar_coreness}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{mil_coreness.png}
        \caption{Milan Coreness Distribution}
        \label{fig:mil_coreness}
    \end{subfigure}
    \caption{Histograms showing the number of stops belonging to each k-shell.}
    \label{fig:coreness_dist}
\end{figure}

\begin{table}[h!]
\centering
\begin{tabular}{|l|c|c|}
\hline
\textbf{City} & \textbf{Max Core ($k_{max}$)} & \textbf{Network Topology Description} \\ \hline
Barcelona     & 2                             & Linear / Ring-like structure          \\ \hline
Milan         & 3                             & Mesh / Interconnected structure       \\ \hline
\end{tabular}
\caption{Maximum K-core values for Barcelona and Milan.}
\label{tab:kcore_results}
\end{table}

As seen in Table \ref{tab:kcore_results}, the $k_{max}$ values are relatively low (2 and 3). This is expected for public transport networks, which are designed as lines rather than dense social meshes.
\begin{itemize}
    \item \textbf{Barcelona ($k_{max}=2$):} The distribution is dominated by stations with $k=2$. This indicates a network composed primarily of simple lines and cycles (loops). There is no subset of stations dense enough to support a 3-core.
    \item \textbf{Milan ($k_{max}=3$):} Milan shows a deeper hierarchy. While most stations are in the 2-core, a distinct subset forms a 3-core. This suggests a denser mesh where stations are more interconnected, likely forming triangles or complex junctions.
\end{itemize}


To visualize where these "core" nodes are located physically, we mapped the stations, distinguishing between the Periphery and the Maximum Core (Figure \ref{fig:core_maps}).

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{bar_core_v_periphery.png}
        \caption{Barcelona: Core ($k=2$) vs Periphery}
        \label{fig:bar_map}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{mil_core_v_periphery.png}
        \caption{Milan: Core ($k=3$) vs Periphery}
        \label{fig:mil_map}
    \end{subfigure}
    \caption{Geographical visualization of the network core. Red points indicate the deepest core ($k_{max}$), while blue points indicate peripheral layers.}
    \label{fig:core_maps}
\end{figure}

\begin{itemize}
    \item In \textbf{Barcelona}, the "Core" ($k=2$) essentially covers the entire active network, excluding only the dead-end branches (periphery). This confirms the decentralized, line-based nature of the system.
    \item In \textbf{Milan}, the "Core" ($k=3$) is likely concentrated in the city center or major exchange hubs. This highlights the areas of highest structural resilience; if peripheral nodes fail, this central red mesh is more likely to remain functional due to its higher interconnectivity.
\end{itemize}

\subsubsection{Modularity (Community Detection)}

To understand the natural substructures of the transit networks, we applied the \textbf{Greedy Modularity} algorithm. This metric quantifies how well a network divides into distinct communities (clusters). A high modularity score ($Q$) implies that stations within a group are densely connected to each other but sparsely connected to stations outside the group. In the context of urban transit, these communities often correspond to specific transit lines, geographic zones, or neighborhoods.

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{bar_mod.png}
        \caption{Barcelona Community Structure}
        \label{fig:bar_mod}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{mil_mod.png}
        \caption{Milan Community Structure}
        \label{fig:mil_mod}
    \end{subfigure}
    \caption{Visualization of network communities detected by the Greedy Modularity algorithm. Colors indicate distinct communities.}
    \label{fig:modularity_plots}
\end{figure}

\begin{table}[h!]
\centering
\begin{tabular}{|l|c|c|}
\hline
\textbf{City} & \textbf{Number of Communities} & \textbf{Modularity ($Q$)} \\ \hline
Barcelona     & 40                             & 0.8901                    \\ \hline
Milan         & 50                             & 0.9273                    \\ \hline
\end{tabular}
\caption{Results of Greedy Modularity optimization for Barcelona and Milan.}
\label{tab:modularity}
\end{table}

\paragraph{Interpretation:}
The results (Table \ref{tab:modularity} and Figure \ref{fig:modularity_plots}) indicate that both cities possess an exceptionally high modularity structure, with $Q$ values approaching the theoretical maximum of 1. 

\begin{itemize}
    \item \textbf{Milan ($Q \approx 0.93$):} The higher modularity and larger number of communities (50) suggest a network that is highly compartmentalized. This indicates a system where transit lines or local zones operate somewhat independently, with fewer "bridge" connections linking different clusters compared to Barcelona.
    \item \textbf{Barcelona ($Q \approx 0.89$):} While still highly modular, Barcelona has fewer communities (40) and a slightly lower $Q$ score. This suggests a slightly more integrated network where the boundaries between different transit zones or lines are somewhat more fluid than in Milan.
\end{itemize}

Overall, the high modularity in both systems reflects the nature of public transport, where stations are often organized linearly along routes, creating strong internal links and fewer cross-route connections.


\subsection{Eﬀiciency Measures}

\subsubsection{Assortativity and Network Resilience}
A key finding of this study is the mixing pattern of the networks. Both cities exhibited \textbf{positive assortativity coefficients}
\[
r_{\text{Barcelona}} \approx 0.129,\qquad
r_{\text{Milan}} \approx 0.118
\]

This result is non-trivial, as many transport networks (such as airline routes) are typically disassortative. The positive values indicate a \textbf{``Rich-Club'' topology}: major hubs in both Barcelona and Milan tend to connect directly to other major hubs. This structure enhances resilience, as the core ``backbone'' of the city remains connected even if peripheral suburban branches are disrupted.

\subsection{Robustness Measures}

To evaluate the resilience of the transport networks, we simulated two types of stress scenarios: \textbf{Random Failures} (simulating accidental technical issues) and \textbf{Targeted Attacks} (simulating the removal of critical hubs or bridges). We measured robustness using the area under the curve (AUC) of the size of the Largest Connected Component (LCC). A higher AUC indicates a network that remains functional longer as nodes are removed.

\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{bar_rob.png}
        \caption{Barcelona Robustness Curves}
        \label{fig:bar_rob}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{mil_rob.png}
        \caption{Milan Robustness Curves}
        \label{fig:mil_rob}
    \end{subfigure}
    \caption{Network disintegration under node removal. The y-axis represents the fraction of the network still connected ($S(f)$), while the x-axis represents the fraction of nodes removed ($f$).}
    \label{fig:robustness_plots}
\end{figure}

\begin{table}[h!]
\centering
\begin{tabular}{|l|c|c|}
\hline
\textbf{Attack Strategy} & \textbf{Barcelona AUC} & \textbf{Milan AUC} \\ \hline
Random Removal (Blue)           & 0.205                  & 0.184              \\ \hline
Targeted Degree (Green)         & 0.079                  & 0.067              \\ \hline
Targeted Betweenness (Red)      & 0.202                  & 0.163              \\ \hline
\end{tabular}
\caption{Robustness scores (AUC). Higher values indicate greater resilience.}
\label{tab:robustness_scores}
\end{table}

The analysis reveals a classic property of scale-free networks: they are robust to errors but fragile to attacks.

\begin{itemize}
    \item \textbf{Random vs. Targeted (General):} In both cities, the networks degrade slowly under random removal (blue lines), maintaining connectivity even after 20-30\% of stations fail. However, under a targeted Degree attack (green lines), the networks collapse almost instantly. Removing just the top 5-10\% of hubs destroys the system's global connectivity.
    
    \item \textbf{Barcelona's Structural Integration:} Barcelona is slightly more robust overall (AUC 0.205 vs 0.184). Notably, Barcelona is highly resistant to Betweenness attacks (Red line). The AUC for Betweenness (0.202) is nearly identical to Random removal (0.205). This suggests that Barcelona has fewer "critical bridges" or bottlenecks; if a bridge is removed, there are likely alternative paths connecting the communities.
    
    \item \textbf{Milan's Vulnerability:} Milan shows a sharper decline under Betweenness attacks (Red line drops to 0.163). This aligns with our earlier Modularity findings ($Q=0.93$); Milan is more compartmentalized. Because the communities are so distinct, cutting the specific stations that bridge these communities causes the network to fracture faster than in Barcelona.
\end{itemize}

\section{Validity Analysis}

To ensure the robustness of our Social Network Analysis (SNA), we evaluated the validity of our results through three key dimensions: data integrity, algorithmic correctness, and real-world ground truthing. 

\subsection{Data Integrity and Limitations}
The study relies on GTFS (General Transit Feed Specification) data, which is the industry standard for public transport schedules. While this ensures high accuracy regarding the \textit{planned} network topology, it presents specific limitations. The analysis treats the network as a static graph based on weekly frequencies, meaning it does not account for real-time disruptions, delays, or passenger congestion levels. Additionally, large transit hubs (such as \textit{Milano Centrale}) are treated as single aggregated nodes to accurately reflect transfer potential, though some intra-station granularity may be lost. 

\subsection{Algorithmic Verification}
   We performed specific mathematical checks to ensure the metrics were calculating correctly: 

\begin{itemize}
   \item \textbf{Assortativity (The "Rich-Club" Effect):} Both networks exhibited positive assortativity (Barcelona: $0.129$, Milan: $0.188$).  This is a significant finding. While many biological or technological networks are disassortative (hubs connect to small nodes), our results indicate that the Metro systems of Barcelona and Milan follow a "Rich-Club" topology, where major hubs preferentially connect to other major hubs. This structure creates a resilient "backbone" that keeps the network functional even if peripheral branches are cut.
    \item \textbf{Modularity Scores:} The community detection algorithm yielded exceptionally high modularity scores (Barcelona: $0.89$, Milan: $0.92$), confirming that the detected "zones" are statistically significant structural clusters rather than random artifacts.
\end{itemize}

\subsection{Ground Truthing (External Validity)}
The most significant test of validity is whether the mathematical results correspond to physical reality.
\begin{itemize}
    \item \textbf{Milan (Central Hubs):} The nodes with the highest Eigenvector Centrality were identified as \textit{Centrale FS}, \textit{Garibaldi FS}, and \textit{Zara}. These correspond exactly to the city's primary railway and metro interchange hubs, confirming the algorithm correctly identified the "center of gravity" of the network. 
    \item \textbf{Barcelona (Strategic Corridors):} Interestingly, for Barcelona, the algorithm assigned high influence to the \textit{L9 Sud corridor} (nodes: \textit{Parc Nou, Aeroport T2, Fira}). This aligns with the line's strategic role as a high-capacity connector linking the Airport and Trade Fair centers to the rest of the grid, validating the metric's ability to detect economically critical infrastructure.
\end{itemize}


\section{Conclusion}

This project applied Social Network Analysis (SNA) to compare the public transport architectures of Barcelona and Milan, revealing how distinct urban planning philosophies manifest in graph topology.

\subsection{Topological Comparison: Grid vs. Radial}
The analysis reveals a fundamental structural divergence between the two cities: 

\begin{itemize}
    \item \textbf{Barcelona (The Resilient Mesh):} The network forms a decentralized grid with 36 distinct communities. The "interlocked" nature of these communities suggests a system designed for high cross-town mobility, reducing the need for all passengers to pass through a single central point. 
    \item \textbf{Milan (The Efficient Radial):} Conversely, Milan exhibits a stronger hierarchical structure with 47 smaller communities radiating from a dense core. The high centrality of stations like \textit{Centrale FS} confirms a system optimized for centripetal flow (moving commuters in and out of the center), which is highly efficient but potentially prone to central congestion.
\end{itemize}

\subsection{Network Robustness}
The positive assortativity coefficients (Barcelona: $0.13$, Milan: $0.19$) are a key indicator of robustness. They suggest that both cities possess a strong "core backbone" where major lines interconnect directly. This is a desirable trait for resilience; if a suburban branch fails, the core network remains intact and operational, preventing cascading failures.

\subsection{Final Implications}
Our results suggest that while Milan’s radial system provides direct access to the city center, its reliance on a few "super-hubs" (like \textit{Garibaldi} and \textit{Centrale}) creates potential bottlenecks. Barcelona’s grid system, highlighted by the prominence of the \textit{L9 Airport connector} in our centrality analysis, distributes importance more evenly across strategic corridors. Future planning for Milan could benefit from "orbital" lines to mimic Barcelona’s mesh-like resilience, reducing pressure on the historic center. 


\begin{thebibliography}{9}
\bibitem{a}
GTFS Documentation: \url{https://gtfs.org}
\bibitem{b}
pandas: \url{https://pandas.com}

\bibitem{c}
pandas: \url{https://pandas.com}

\bibitem{vonferber}
C.~von Ferber, T.~Holovatch, Y.~Holovatch, and V.~Palchykov.
\textit{Public transport networks: empirical analysis and modeling}.
arXiv:0803.3514, 2008. Available at: \url{https://arxiv.org/abs/0803.3514}
\end{thebibliography}

\end{document}
